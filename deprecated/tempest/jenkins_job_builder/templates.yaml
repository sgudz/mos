- job-template:
    name: '{env}_env_run_tempest'
    description: 'Run tempest tests on ENV {env}'
    display-name: '05 Run tempest tests on ENV {env}'
    node: master
    logrotate:
      daysToKeep: 60
      numToKeep: 100
    properties:
      - throttle:
          categories:
            - ENV_{env}
          max-total: 1
          option: category
    wrappers:
        - build-user-vars
        - timestamps
        - ansicolor:
            colormap: xterm
        - locks:
            - ENV_{env}
    scm:
        - main-git
    parameters:
        - choice:
            name: EXECUTION_TYPE
            choices:
                - 'scale'
                - 'debug'
        - string:
            name: REFSPEC
            default: '+refs/heads/*:refs/remotes/origin/*'
            description:
                !include-raw descriptions/REFSPEC
        - choice:
            name: BRANCH
            description:
                !include-raw descriptions/BRANCH
            choices:
                - '0.0.6'
                - '0.0.5'
                - '0.0.4'
                - 'origin/master'
                - 'FETCH_HEAD'
    builders:
        - shell:
             |
             export FUEL_IP=172.16.44.{env}
             if [ -f $WORKSPACE/jenkins/run_tests.sh ]; then
                $WORKSPACE/jenkins/run_tests.sh -r tempest
             fi
             if [ $WORKSPACE/run_tests/run_tempest.sh ]; then
                $WORKSPACE/run_tests/run_tempest.sh
             fi
    publishers:
        - email-ext-main
        - junit:
            results: '*.xml'
